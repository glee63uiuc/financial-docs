<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Document Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .main-content {
            padding: 30px;
        }

        .upload-section {
            background: #f8f9fa;
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .upload-section:hover {
            border-color: #764ba2;
            background: #f0f1ff;
        }

        .upload-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .processing {
            display: none;
            text-align: center;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            margin: 20px 0;
        }

        .processing.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .documents-view {
            margin-top: 30px;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .view-toggle button {
            padding: 10px 20px;
            border: none;
            background: none;
            color: #6c757d;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .view-toggle button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .folder {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .folder-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-header:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .folder-name {
            font-weight: 600;
            font-size: 18px;
        }

        .folder-count {
            background: rgba(255,255,255,0.3);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
        }

        .folder-content {
            display: none;
            padding: 20px;
            background: #f8f9fa;
        }

        .folder-content.open {
            display: block;
        }

        .document-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .document-item:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            transform: translateX(5px);
        }

        .document-info {
            flex: 1;
        }

        .document-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .document-date {
            color: #6c757d;
            font-size: 14px;
        }

        .document-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-view {
            background: #667eea;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-small:hover {
            opacity: 0.8;
        }

        .index-view {
            display: none;
        }

        .index-view.active {
            display: block;
        }

        .index-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .index-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .index-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .index-table tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        input[type="file"] {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001;
        }

        .modal-image {
            width: 100%;
            display: block;
        }

        .backup-reminder {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.3);
            display: none;
        }

        .backup-reminder.show {
            display: block;
        }

        .backup-reminder h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .backup-reminder p {
            margin-bottom: 15px;
            opacity: 0.95;
        }

        .backup-reminder .btn {
            background: white;
            color: #f5576c;
            font-weight: 700;
        }

        .backup-reminder .btn:hover {
            background: #fff;
            transform: scale(1.05);
        }

        .last-backup-info {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 12px 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 14px;
            color: #333;
        }

        .backup-stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .backup-stat {
            background: rgba(255,255,255,0.3);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 13px;
        }

        .help-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .help-modal.active {
            display: block;
        }

        .help-content {
            background: white;
            max-width: 900px;
            margin: 40px auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .help-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .help-header h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .help-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .help-close:hover {
            background: rgba(255,255,255,0.5);
            transform: rotate(90deg);
        }

        .help-navigation {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .help-nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .help-nav-button {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-nav-button:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .help-nav-button.active {
            background: #667eea;
            color: white;
        }

        .help-body {
            padding: 30px;
            max-height: 500px;
            overflow-y: auto;
        }

        .help-section {
            display: none;
        }

        .help-section.active {
            display: block;
        }

        .help-section h3 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .help-section h4 {
            color: #333;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .help-section p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .help-section ul, .help-section ol {
            margin-left: 20px;
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .help-section li {
            margin-bottom: 8px;
            color: #555;
        }

        .help-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .help-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .help-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .help-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        .help-code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .help-button {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .help-content {
                margin: 20px auto;
            }

            .help-nav-grid {
                grid-template-columns: 1fr;
            }

            .help-body {
                padding: 20px;
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            .upload-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .document-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .document-actions {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÅ Financial Document Manager</h1>
            <p>Automatically organize your bank statements, investment docs & insurance papers</p>
        </div>

        <div class="main-content">
            <div class="upload-section">
                <h2>üì∏ Add New Document</h2>
                <p style="margin: 10px 0; color: #6c757d;">Take a photo or upload a file - we'll organize it automatically!</p>
                <div class="upload-buttons">
                    <button class="btn btn-primary" onclick="takePhoto()">
                        üì∑ Take Photo
                    </button>
                    <button class="btn btn-primary" onclick="uploadFile()">
                        üìÑ Upload File
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()">
                        üíæ Export All Data
                    </button>
                    <button class="btn btn-secondary" onclick="importData()">
                        üì• Import Data
                    </button>
                </div>
                <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleFileSelect(event)">
                <input type="file" id="fileInput" accept="image/*,application/pdf" onchange="handleFileSelect(event)">
                <input type="file" id="importInput" accept=".json" onchange="handleImport(event)">
            </div>

            <div class="processing" id="processing">
                <div class="spinner"></div>
                <p id="processingText">Processing your document...</p>
            </div>

            <div class="backup-reminder" id="backupReminder">
                <h3>‚è∞ Monthly Backup Reminder</h3>
                <p id="backupMessage">It's time to backup your documents to Google Drive!</p>
                <div class="backup-stats">
                    <span class="backup-stat" id="docCount">üìÑ 0 documents</span>
                    <span class="backup-stat" id="lastBackup">Last backup: Never</span>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="createBackup()">
                        üíæ Download Backup File
                    </button>
                    <button class="btn btn-secondary" onclick="dismissBackupReminder()">
                        Remind Me in 7 Days
                    </button>
                </div>
                <p style="font-size: 13px; margin-top: 10px; opacity: 0.9;">
                    After downloading, open Google Drive app and upload the file to keep your documents safe!
                </p>
            </div>

            <div class="documents-view">
                <div class="view-toggle">
                    <button class="active" onclick="switchView('folders')">üìÅ By Investment</button>
                    <button onclick="switchView('index')">üìã Master Index</button>
                </div>

                <div id="foldersView" class="folders-view">
                    <div id="foldersList"></div>
                </div>

                <div id="indexView" class="index-view">
                    <table class="index-table" id="indexTable">
                        <thead>
                            <tr>
                                <th>Investment</th>
                                <th>Document Type</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="indexTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="imageModal">
        <button class="modal-close" onclick="closeModal()">√ó</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="Document">
        </div>
    </div>

    <!-- Help Button -->
    <button class="help-button" onclick="openHelp()" title="Help & Instructions">
        ‚ùì
    </button>

    <!-- Help Modal -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <div class="help-header">
                <button class="help-close" onclick="closeHelp()">√ó</button>
                <h2>üìñ User Manual & Guide</h2>
                <p>Everything you need to know about managing your financial documents</p>
            </div>
            
            <div class="help-navigation">
                <div class="help-nav-grid">
                    <button class="help-nav-button active" onclick="showHelpSection('getting-started')">
                        üöÄ Getting Started
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('buttons')">
                        üîò Button Guide
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('how-to')">
                        üìù How to Use
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('storage')">
                        üíæ Data Storage
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('backup')">
                        üîÑ Backup System
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('troubleshooting')">
                        üîß Troubleshooting
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('tips')">
                        üí° Tips & Best Practices
                    </button>
                    <button class="help-nav-button" onclick="showHelpSection('quick-ref')">
                        ‚ö° Quick Reference
                    </button>
                </div>
            </div>

            <div class="help-body">
                <!-- Getting Started Section -->
                <div id="getting-started" class="help-section active">
                    <h3>üöÄ Getting Started</h3>
                    
                    <h4>What You Need</h4>
                    <ul>
                        <li>‚úÖ iPhone, iPad, or Mac with Safari browser</li>
                        <li>‚úÖ Camera access (for taking photos of documents)</li>
                        <li>‚úÖ Google Drive app (for storing backups)</li>
                        <li>‚úÖ Internet connection (to process documents with AI)</li>
                    </ul>

                    <h4>First Time Setup - iPhone/iPad</h4>
                    <ol>
                        <li>Download the <code>financial-doc-manager.html</code> file</li>
                        <li>Open the file in Safari browser</li>
                        <li>Tap the Share button (box with arrow)</li>
                        <li>Select "Add to Home Screen"</li>
                        <li>Name it "My Documents" or your preference</li>
                        <li>Tap "Add" - now you have an app icon!</li>
                    </ol>

                    <h4>First Time Setup - Mac</h4>
                    <ol>
                        <li>Download the <code>financial-doc-manager.html</code> file</li>
                        <li>Save it to your Documents folder</li>
                        <li>Double-click to open in Safari</li>
                        <li>Bookmark it (‚åò+D) for easy access</li>
                        <li>Optional: Drag to Dock for quick access</li>
                    </ol>

                    <div class="help-box help-success">
                        <strong>‚úÖ Ready to Go!</strong><br>
                        Once set up, you can start uploading documents immediately. The app will automatically organize everything for you.
                    </div>
                </div>

                <!-- Button Guide Section -->
                <div id="buttons" class="help-section">
                    <h3>üîò Button Guide</h3>
                    
                    <h4>üì∑ Take Photo</h4>
                    <p><strong>What it does:</strong> Opens your camera to photograph a document</p>
                    <p><strong>When to use:</strong> When you have physical paper documents</p>
                    <p><strong>How it works:</strong> Tap ‚Üí Camera opens ‚Üí Take photo ‚Üí Wait 5-10 seconds ‚Üí Done!</p>

                    <h4>üìÑ Upload File</h4>
                    <p><strong>What it does:</strong> Lets you select existing photos or PDFs</p>
                    <p><strong>When to use:</strong> When you already have digital documents</p>
                    <p><strong>How it works:</strong> Tap ‚Üí Choose from Photos/Files ‚Üí Select ‚Üí Done!</p>

                    <h4>üíæ Export All Data</h4>
                    <p><strong>What it does:</strong> Downloads a backup of ALL documents</p>
                    <p><strong>When to use:</strong> Monthly backups, before clearing cache</p>
                    <p><strong>Result:</strong> Creates file named <code>financial-docs-backup-2026-02-08.json</code></p>

                    <h4>üì• Import Data</h4>
                    <p><strong>What it does:</strong> Restores documents from backup</p>
                    <p><strong>When to use:</strong> After data loss, setting up new device</p>
                    <p><strong>How it works:</strong> Tap ‚Üí Select backup file ‚Üí Confirm ‚Üí Restored!</p>

                    <h4>View (Blue Button)</h4>
                    <p><strong>What it does:</strong> Opens document in full screen</p>
                    <p><strong>Close:</strong> Tap X or click outside image</p>

                    <h4>Delete (Red Button)</h4>
                    <p><strong>What it does:</strong> Permanently removes document</p>
                    <div class="help-box help-danger">
                        <strong>‚ö†Ô∏è Warning:</strong> This cannot be undone! Backup first.
                    </div>
                </div>

                <!-- How to Use Section -->
                <div id="how-to" class="help-section">
                    <h3>üìù How to Use</h3>
                    
                    <h4>Scenario 1: Adding Your First Document</h4>
                    <ol>
                        <li>Open the app</li>
                        <li>Have your document ready (paper or digital)</li>
                        <li>Tap "üì∑ Take Photo" or "üìÑ Upload File"</li>
                        <li>Capture/select the image (ensure text is clear)</li>
                        <li>Wait 5-10 seconds while processing</li>
                        <li>Document appears automatically in its folder!</li>
                    </ol>

                    <div class="help-box help-info">
                        <strong>What the app does automatically:</strong><br>
                        ‚Ä¢ Reads company name (e.g., "DBS Bank")<br>
                        ‚Ä¢ Finds the date (e.g., "January 2026")<br>
                        ‚Ä¢ Identifies type (e.g., "Monthly Statement")<br>
                        ‚Ä¢ Creates folder and saves chronologically
                    </div>

                    <h4>Scenario 2: Finding a Document</h4>
                    <p><strong>Method A - Browse by Company:</strong></p>
                    <ol>
                        <li>Ensure "üìÅ By Investment" is selected</li>
                        <li>Scroll to find company folder</li>
                        <li>Tap folder name to expand</li>
                        <li>Find document by date</li>
                        <li>Tap "View" to open</li>
                    </ol>

                    <p><strong>Method B - Use Master Index:</strong></p>
                    <ol>
                        <li>Tap "üìã Master Index"</li>
                        <li>Scroll through table (sorted by date)</li>
                        <li>Find your document</li>
                        <li>Tap "View" to open</li>
                    </ol>

                    <h4>Scenario 3: Monthly Backup</h4>
                    <p><strong>When pink reminder appears:</strong></p>
                    <ol>
                        <li>Read reminder (shows doc count & last backup date)</li>
                        <li>Tap "üíæ Download Backup File"</li>
                        <li>Open Google Drive app</li>
                        <li>Tap "+" then "Upload"</li>
                        <li>Select the backup file from Downloads</li>
                        <li>Choose/create "Financial Backups" folder</li>
                        <li>Upload complete - safe for 30 days!</li>
                    </ol>

                    <div class="help-box help-success">
                        <strong>Not ready to backup?</strong><br>
                        Tap "Remind Me in 7 Days" to snooze the reminder.
                    </div>
                </div>

                <!-- Storage Section -->
                <div id="storage" class="help-section">
                    <h3>üíæ Data Storage & Safety</h3>
                    
                    <h4>Where Is Your Data Stored?</h4>
                    <p><strong>Primary Storage:</strong> Browser's Local Storage (inside Safari on your device)</p>
                    <p><strong>Privacy:</strong> Completely private - stored ONLY on YOUR device</p>
                    <p><strong>Access:</strong> Only you can see it (not shared with anyone)</p>

                    <div class="help-box help-info">
                        <strong>Think of it like this:</strong><br>
                        Your iPhone/Mac ‚Üí Safari Browser ‚Üí Local Storage (filing cabinet) ‚Üí Financial Documents folder ‚Üí Your documents
                    </div>

                    <h4>What Data Is Stored?</h4>
                    <p>For each document:</p>
                    <ul>
                        <li>Image/PDF data (the actual document)</li>
                        <li>Investment name (e.g., "DBS Bank")</li>
                        <li>Document type (e.g., "Monthly Statement")</li>
                        <li>Date (e.g., "2026-02-08")</li>
                        <li>Upload date</li>
                        <li>Unique ID</li>
                    </ul>

                    <h4>Is Your Data Safe?</h4>
                    <div class="help-box help-success">
                        <strong>‚úÖ YES - If you backup regularly</strong><br>
                        ‚Ä¢ Monthly backups to Google Drive<br>
                        ‚Ä¢ Backup before clearing browser data<br>
                        ‚Ä¢ Backup before device updates<br>
                        ‚Ä¢ Keep backups before switching devices
                    </div>

                    <div class="help-box help-danger">
                        <strong>‚ùå AT RISK - If you don't backup</strong><br>
                        ‚Ä¢ Clearing Safari browsing data = ALL LOST<br>
                        ‚Ä¢ Clearing browser cache = Might be lost<br>
                        ‚Ä¢ Device failure = LOST<br>
                        ‚Ä¢ No recovery without backup!
                    </div>

                    <div class="help-box help-info">
                        <strong>üîë GOLDEN RULE:</strong><br>
                        Backup every 30 days to Google Drive!
                    </div>
                </div>

                <!-- Backup System Section -->
                <div id="backup" class="help-section">
                    <h3>üîÑ Backup System</h3>
                    
                    <h4>How Automatic Reminders Work</h4>
                    <div class="help-code">
Day 0:    Add first document
Day 1-29: No reminder (building collection)
Day 30:   üîî Pink reminder appears!
          ‚îî‚îÄ Backup ‚Üí Reminder disappears
Day 60:   üîî Reminder appears again
          ‚îî‚îÄ Backup ‚Üí Reminder disappears
                    </div>

                    <h4>Backup File Details</h4>
                    <p><strong>File Name:</strong> <code>financial-docs-backup-2026-02-08.json</code></p>
                    <ul>
                        <li><code>financial-docs-backup</code> = App name</li>
                        <li><code>2026-02-08</code> = Backup creation date</li>
                        <li><code>.json</code> = Data file format</li>
                    </ul>

                    <h4>File Size Guide</h4>
                    <ul>
                        <li>10 documents ‚âà 5-10 MB</li>
                        <li>50 documents ‚âà 25-50 MB</li>
                        <li>100 documents ‚âà 50-100 MB</li>
                    </ul>

                    <h4>Best Practices</h4>
                    <p><strong>Google Drive Organization:</strong></p>
                    <div class="help-code">
Google Drive
‚îî‚îÄ Financial Documents
    ‚îî‚îÄ Backups
        ‚îú‚îÄ financial-docs-backup-2026-01-15.json
        ‚îú‚îÄ financial-docs-backup-2026-02-08.json
        ‚îú‚îÄ financial-docs-backup-2026-03-10.json
        ‚îî‚îÄ financial-docs-backup-2026-04-05.json
                    </div>

                    <p><strong>Recommended Schedule:</strong></p>
                    <ul>
                        <li><strong>Monthly backups</strong> - Follow automatic reminders</li>
                        <li><strong>Before major changes</strong> - Always backup first</li>
                        <li><strong>Keep 3-6 months</strong> - Safe but not cluttered</li>
                        <li><strong>Delete old backups</strong> - After 6+ months (optional)</li>
                    </ul>

                    <div class="help-box help-success">
                        <strong>üí° Pro Tip:</strong><br>
                        Set a monthly calendar reminder on your phone: "Backup financial documents"
                    </div>
                </div>

                <!-- Troubleshooting Section -->
                <div id="troubleshooting" class="help-section">
                    <h3>üîß Troubleshooting</h3>
                    
                    <h4>Document Won't Upload</h4>
                    <p><strong>Possible causes:</strong></p>
                    <ul>
                        <li><strong>Blurry photo</strong> ‚Üí Take again with better lighting, hold steady</li>
                        <li><strong>File too large</strong> ‚Üí Max ~10 MB, try lower resolution</li>
                        <li><strong>No internet</strong> ‚Üí App needs connection to process (uses AI)</li>
                        <li><strong>Camera permission</strong> ‚Üí Settings ‚Üí Safari ‚Üí Camera ‚Üí Allow</li>
                    </ul>

                    <h4>Processing Takes Too Long</h4>
                    <p><strong>Normal time:</strong> 5-15 seconds</p>
                    <p><strong>If longer than 30 seconds:</strong></p>
                    <ol>
                        <li>Check internet connection</li>
                        <li>Refresh the page</li>
                        <li>Try uploading again</li>
                    </ol>

                    <h4>Wrong Information Extracted</h4>
                    <p><strong>Example:</strong> App read "DBS" as "DES" or wrong date</p>
                    <p><strong>Solution:</strong></p>
                    <ol>
                        <li>Delete the document</li>
                        <li>Take a clearer photo</li>
                        <li>Ensure good lighting</li>
                        <li>Make sure text isn't cut off</li>
                        <li>Upload again</li>
                    </ol>

                    <h4>All Documents Disappeared!</h4>
                    <div class="help-box help-danger">
                        <strong>Most likely:</strong> Browser data was cleared
                    </div>
                    <p><strong>Solution:</strong></p>
                    <ol>
                        <li>Find backup file in Google Drive</li>
                        <li>Download to device</li>
                        <li>Open app</li>
                        <li>Tap "üì• Import Data"</li>
                        <li>Select backup file</li>
                        <li>Documents restored!</li>
                    </ol>

                    <div class="help-box help-info">
                        <strong>Prevention:</strong> Backup monthly! Don't clear Safari data without backing up first.
                    </div>
                </div>

                <!-- Tips Section -->
                <div id="tips" class="help-section">
                    <h3>üí° Tips & Best Practices</h3>
                    
                    <h4>üì∏ Photography Tips</h4>
                    <p><strong>For best results:</strong></p>
                    <ul>
                        <li>‚úÖ Use good lighting (natural light is best)</li>
                        <li>‚úÖ Lay document flat on table</li>
                        <li>‚úÖ Take photo straight-on (not at angle)</li>
                        <li>‚úÖ Ensure all text is in frame</li>
                        <li>‚úÖ Avoid shadows on document</li>
                        <li>‚úÖ High contrast = easier to read</li>
                    </ul>

                    <h4>üìÅ Organization Tips</h4>
                    <ul>
                        <li>Upload documents monthly (don't let them pile up)</li>
                        <li>Delete duplicates immediately</li>
                        <li>Use Master Index to find recent documents</li>
                        <li>Check document names match correctly</li>
                    </ul>

                    <h4>üîí Safety Tips</h4>
                    <ol>
                        <li><strong>Backup monthly</strong> - Set calendar reminder</li>
                        <li><strong>Keep backups in Google Drive</strong> - Not just on device</li>
                        <li><strong>Test your backup</strong> - Import once to verify it works</li>
                        <li><strong>Don't clear browser data</strong> - Without backing up first</li>
                        <li><strong>Keep 2-3 recent backups</strong> - For redundancy</li>
                    </ol>

                    <h4>üë¥üëµ For Parents/Beginners</h4>
                    <div class="help-box help-success">
                        <strong>Simplified Workflow:</strong><br><br>
                        <strong>Adding Documents:</strong><br>
                        Open app ‚Üí Tap camera button ‚Üí Take photo ‚Üí Wait 10 sec ‚Üí Done!<br><br>
                        <strong>Backing Up (Monthly):</strong><br>
                        See pink box ‚Üí Tap "Download" ‚Üí Open Google Drive ‚Üí Upload ‚Üí Done!<br><br>
                        <strong>Finding Documents:</strong><br>
                        Tap folder ‚Üí Find date ‚Üí Tap "View" ‚Üí Done!
                    </div>

                    <h4>‚ö° Time-Saving Tips</h4>
                    <ul>
                        <li>Batch upload multiple documents at once</li>
                        <li>Take photos as statements arrive</li>
                        <li>Use Master Index for quick scanning</li>
                        <li>Keep Google Drive on home screen</li>
                        <li>Set monthly reminder: "Backup financial docs"</li>
                    </ul>
                </div>

                <!-- Quick Reference Section -->
                <div id="quick-ref" class="help-section">
                    <h3>‚ö° Quick Reference Card</h3>
                    
                    <h4>Daily Use</h4>
                    <div class="help-code">
<strong>Upload Document:</strong>
üì∑ Take Photo ‚Üí Wait 10 sec ‚Üí Done

<strong>View Document:</strong>
Find folder ‚Üí Tap to expand ‚Üí Tap "View"

<strong>Delete Document:</strong>
Find document ‚Üí Tap "Delete" ‚Üí Confirm
                    </div>

                    <h4>Monthly Maintenance</h4>
                    <div class="help-code">
<strong>Backup (when pink box appears):</strong>
üíæ Download Backup ‚Üí Open Google Drive ‚Üí Upload file
                    </div>

                    <h4>Emergency Recovery</h4>
                    <div class="help-code">
<strong>Lost all documents:</strong>
üì• Import Data ‚Üí Select backup from Google Drive ‚Üí Confirm
                    </div>

                    <h4>Contact Information</h4>
                    <p><strong>Google Drive backup email:</strong> glee63uiuc@gmail.com</p>
                    <p><strong>Recommended folder:</strong> Financial Documents/Backups</p>

                    <h4>üéØ Most Important Points</h4>
                    <div class="help-box help-danger">
                        <strong>What You MUST Know:</strong>
                        <ol>
                            <li>App stores documents in browser - not cloud</li>
                            <li>Backup every 30 days or risk losing everything</li>
                            <li>Don't clear browser data without backup</li>
                            <li>Keep HTML file safe to access documents</li>
                            <li>Pink reminder is your friend - don't ignore it!</li>
                        </ol>
                    </div>

                    <div class="help-box help-success">
                        <strong>Remember:</strong><br>
                        This app is as safe as your backup habits!<br>
                        Backup monthly = Sleep peacefully üò¥üí§
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Storage using browser's localStorage with persistence
        let documents = [];
        let backupSettings = {
            lastBackupDate: null,
            backupFrequencyDays: 30,
            reminderDismissed: false,
            dismissedDate: null
        };
        
        // Load documents from localStorage on page load
        function loadDocuments() {
            const stored = localStorage.getItem('financialDocuments');
            if (stored) {
                documents = JSON.parse(stored);
                renderDocuments();
            } else {
                showEmptyState();
            }
            
            // Load backup settings
            const storedSettings = localStorage.getItem('backupSettings');
            if (storedSettings) {
                backupSettings = JSON.parse(storedSettings);
            }
            
            // Check if backup reminder should be shown
            checkBackupReminder();
        }

        // Save documents to localStorage
        function saveDocuments() {
            localStorage.setItem('financialDocuments', JSON.stringify(documents));
        }

        // Save backup settings
        function saveBackupSettings() {
            localStorage.setItem('backupSettings', JSON.stringify(backupSettings));
        }

        // Check if backup reminder should be shown
        function checkBackupReminder() {
            const now = new Date();
            const reminderElement = document.getElementById('backupReminder');
            const lastBackup = backupSettings.lastBackupDate ? new Date(backupSettings.lastBackupDate) : null;
            const dismissedDate = backupSettings.dismissedDate ? new Date(backupSettings.dismissedDate) : null;
            
            // Calculate days since last backup
            let daysSinceBackup = Infinity;
            if (lastBackup) {
                daysSinceBackup = Math.floor((now - lastBackup) / (1000 * 60 * 60 * 24));
            }
            
            // Calculate days since dismissed
            let daysSinceDismissed = Infinity;
            if (dismissedDate) {
                daysSinceDismissed = Math.floor((now - dismissedDate) / (1000 * 60 * 60 * 24));
            }
            
            // Show reminder if:
            // 1. Never backed up and have documents, OR
            // 2. Been 30+ days since last backup, AND
            // 3. Haven't dismissed in last 7 days
            const shouldShow = documents.length > 0 && 
                             daysSinceBackup >= backupSettings.backupFrequencyDays &&
                             daysSinceDismissed >= 7;
            
            if (shouldShow) {
                reminderElement.classList.add('show');
                updateBackupStats();
            } else {
                reminderElement.classList.remove('show');
            }
        }

        // Update backup statistics display
        function updateBackupStats() {
            document.getElementById('docCount').textContent = `üìÑ ${documents.length} document${documents.length !== 1 ? 's' : ''}`;
            
            const lastBackupText = backupSettings.lastBackupDate 
                ? `Last backup: ${formatDate(backupSettings.lastBackupDate)}`
                : 'Last backup: Never';
            document.getElementById('lastBackup').textContent = lastBackupText;
            
            // Update message based on urgency
            const daysSinceBackup = backupSettings.lastBackupDate 
                ? Math.floor((new Date() - new Date(backupSettings.lastBackupDate)) / (1000 * 60 * 60 * 24))
                : Infinity;
            
            let message = "It's time to backup your documents to Google Drive!";
            if (daysSinceBackup > 60) {
                message = "‚ö†Ô∏è It's been over 2 months! Please backup your documents now.";
            } else if (daysSinceBackup > 45) {
                message = "üì¢ Your documents need backing up soon!";
            } else if (!backupSettings.lastBackupDate) {
                message = "üìÅ Create your first backup to keep documents safe!";
            }
            
            document.getElementById('backupMessage').textContent = message;
        }

        // Create and download backup file
        function createBackup() {
            const backupData = {
                exportDate: new Date().toISOString(),
                documentCount: documents.length,
                documents: documents,
                version: "1.0"
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            const dateStr = new Date().toISOString().split('T')[0];
            link.download = `financial-docs-backup-${dateStr}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            // Update backup settings
            backupSettings.lastBackupDate = new Date().toISOString();
            backupSettings.reminderDismissed = false;
            saveBackupSettings();
            
            // Hide reminder and show success message
            document.getElementById('backupReminder').classList.remove('show');
            alert(`‚úÖ Backup file downloaded!\n\nDocuments: ${documents.length}\nFilename: financial-docs-backup-${dateStr}.json\n\nNext step: Open Google Drive app and upload this file to keep it safe!`);
        }

        // Dismiss backup reminder for 7 days
        function dismissBackupReminder() {
            backupSettings.dismissedDate = new Date().toISOString();
            backupSettings.reminderDismissed = true;
            saveBackupSettings();
            document.getElementById('backupReminder').classList.remove('show');
        }

        function takePhoto() {
            document.getElementById('cameraInput').click();
        }

        function uploadFile() {
            document.getElementById('fileInput').click();
        }

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            showProcessing('Reading document...');

            // Convert file to base64
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Data = e.target.result;
                
                showProcessing('Analyzing document with AI...');
                
                // Extract text and metadata using Claude API
                await processDocument(base64Data, file.type);
            };
            reader.readAsDataURL(file);
        }

        async function processDocument(base64Data, mimeType) {
            try {
                const isImage = mimeType.startsWith('image/');
                const isPDF = mimeType === 'application/pdf';

                let content;
                if (isImage) {
                    content = [
                        {
                            type: "image",
                            source: {
                                type: "base64",
                                media_type: mimeType,
                                data: base64Data.split(',')[1]
                            }
                        },
                        {
                            type: "text",
                            text: `Analyze this financial document and extract the following information in JSON format ONLY (no other text):

{
  "investment_name": "Name of the investment/bank/insurance company",
  "document_type": "Type of document (e.g., Monthly Statement, Annual Report, Policy Document)",
  "document_date": "Date in YYYY-MM-DD format",
  "institution": "Financial institution name"
}

Return ONLY the JSON, nothing else.`
                        }
                    ];
                } else if (isPDF) {
                    content = [
                        {
                            type: "document",
                            source: {
                                type: "base64",
                                media_type: "application/pdf",
                                data: base64Data.split(',')[1]
                            }
                        },
                        {
                            type: "text",
                            text: `Analyze this financial document and extract the following information in JSON format ONLY (no other text):

{
  "investment_name": "Name of the investment/bank/insurance company",
  "document_type": "Type of document (e.g., Monthly Statement, Annual Report, Policy Document)",
  "document_date": "Date in YYYY-MM-DD format",
  "institution": "Financial institution name"
}

Return ONLY the JSON, nothing else.`
                        }
                    ];
                }

                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            {
                                role: "user",
                                content: content
                            }
                        ]
                    })
                });

                const data = await response.json();
                const responseText = data.content[0].text;
                
                // Parse the JSON response
                const cleanedResponse = responseText.replace(/```json|```/g, '').trim();
                const metadata = JSON.parse(cleanedResponse);

                // Create document object
                const doc = {
                    id: Date.now(),
                    investment: metadata.investment_name || metadata.institution || 'Unknown',
                    type: metadata.document_type || 'Statement',
                    date: metadata.document_date || new Date().toISOString().split('T')[0],
                    imageData: base64Data,
                    mimeType: mimeType,
                    uploadDate: new Date().toISOString()
                };

                documents.push(doc);
                saveDocuments();
                renderDocuments();
                hideProcessing();
                
                // Check if backup reminder should be shown after adding document
                checkBackupReminder();

                // Reset file inputs
                document.getElementById('cameraInput').value = '';
                document.getElementById('fileInput').value = '';

            } catch (error) {
                console.error('Error processing document:', error);
                hideProcessing();
                alert('Error processing document. Please try again. Error: ' + error.message);
            }
        }

        function showProcessing(message) {
            document.getElementById('processing').classList.add('active');
            document.getElementById('processingText').textContent = message;
        }

        function hideProcessing() {
            document.getElementById('processing').classList.remove('active');
        }

        function renderDocuments() {
            if (documents.length === 0) {
                showEmptyState();
                return;
            }

            // Group documents by investment
            const grouped = {};
            documents.forEach(doc => {
                if (!grouped[doc.investment]) {
                    grouped[doc.investment] = [];
                }
                grouped[doc.investment].push(doc);
            });

            // Sort documents within each group by date (newest first)
            Object.keys(grouped).forEach(investment => {
                grouped[investment].sort((a, b) => new Date(b.date) - new Date(a.date));
            });

            // Render folders view
            const foldersList = document.getElementById('foldersList');
            foldersList.innerHTML = '';

            Object.keys(grouped).sort().forEach(investment => {
                const docs = grouped[investment];
                const folderHtml = `
                    <div class="folder">
                        <div class="folder-header" onclick="toggleFolder(this)">
                            <span class="folder-name">üìÇ ${investment}</span>
                            <span class="folder-count">${docs.length} document${docs.length > 1 ? 's' : ''}</span>
                        </div>
                        <div class="folder-content">
                            ${docs.map(doc => `
                                <div class="document-item">
                                    <div class="document-info">
                                        <div class="document-name">${doc.type}</div>
                                        <div class="document-date">üìÖ ${formatDate(doc.date)}</div>
                                    </div>
                                    <div class="document-actions">
                                        <button class="btn-small btn-view" onclick="viewDocument(${doc.id})">View</button>
                                        <button class="btn-small btn-delete" onclick="deleteDocument(${doc.id})">Delete</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                foldersList.innerHTML += folderHtml;
            });

            // Render index view
            const indexTableBody = document.getElementById('indexTableBody');
            indexTableBody.innerHTML = '';

            // Sort all documents by date for index
            const sortedDocs = [...documents].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedDocs.forEach(doc => {
                const row = `
                    <tr>
                        <td><strong>${doc.investment}</strong></td>
                        <td>${doc.type}</td>
                        <td>${formatDate(doc.date)}</td>
                        <td>
                            <button class="btn-small btn-view" onclick="viewDocument(${doc.id})">View</button>
                            <button class="btn-small btn-delete" onclick="deleteDocument(${doc.id})">Delete</button>
                        </td>
                    </tr>
                `;
                indexTableBody.innerHTML += row;
            });
        }

        function showEmptyState() {
            document.getElementById('foldersList').innerHTML = `
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <h3>No documents yet</h3>
                    <p>Start by taking a photo or uploading a document above</p>
                </div>
            `;
            document.getElementById('indexTableBody').innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: #6c757d;">
                        No documents to display
                    </td>
                </tr>
            `;
        }

        function toggleFolder(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('open');
        }

        function switchView(view) {
            const buttons = document.querySelectorAll('.view-toggle button');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (view === 'folders') {
                document.getElementById('foldersView').style.display = 'block';
                document.getElementById('indexView').classList.remove('active');
            } else {
                document.getElementById('foldersView').style.display = 'none';
                document.getElementById('indexView').classList.add('active');
            }
        }

        function viewDocument(id) {
            const doc = documents.find(d => d.id === id);
            if (doc) {
                document.getElementById('modalImage').src = doc.imageData;
                document.getElementById('imageModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        function deleteDocument(id) {
            if (confirm('Are you sure you want to delete this document?')) {
                documents = documents.filter(d => d.id !== id);
                saveDocuments();
                renderDocuments();
                checkBackupReminder();
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function exportData() {
            createBackup();
        }

        function importData() {
            document.getElementById('importInput').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Handle both old and new backup formats
                    const importedDocs = importedData.documents || importedData;
                    
                    if (confirm(`Import ${importedDocs.length} documents? This will add to your existing documents.`)) {
                        documents = [...documents, ...importedDocs];
                        saveDocuments();
                        renderDocuments();
                        checkBackupReminder();
                        alert('Documents imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                }
                event.target.value = '';
            };
            reader.readAsText(file);
        }

        // Load documents when page loads
        window.addEventListener('load', loadDocuments);

        // Close modal when clicking outside
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Help modal functions
        function openHelp() {
            document.getElementById('helpModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        function showHelpSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.help-section');
            sections.forEach(section => section.classList.remove('active'));

            // Remove active class from all nav buttons
            const navButtons = document.querySelectorAll('.help-nav-button');
            navButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Highlight active nav button
            event.target.classList.add('active');

            // Scroll to top of help body
            document.querySelector('.help-body').scrollTop = 0;
        }

        // Close help modal when clicking outside
        document.getElementById('helpModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHelp();
            }
        });
    </script>
</body>
</html>
